<div class="container mt-4">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h2>ملف اللاعب: <%= player.name %></h2>
    <% if (user && user.isAdmin) { %>
    <a href="/listings/<%= player.category %>" class="btn btn-secondary">
      <i class="fas fa-arrow-left me-1"></i> العودة إلى القائمة
    </a>
    <%}%>
  </div>

  <div class="row">

    <div class="col-md-6">
      <div class="card mb-4">
        <div class="card-header bg-primary text-white">
          <h5 class="mb-0">المعلومات الأساسية</h5>
        </div>
        <div class="card-body">
          <div class="row">
            <div class="col-md-6">
              <p><strong>الاسم:</strong> <%= player.name %></p>
              <p><strong>الفئة:</strong> <%= categoryName %></p>
              <p><strong>رقم القميص:</strong> <%= player.shirtNumber || 'غير محدد' %></p>
            </div>
            <div class="col-md-6">
              <p><strong>الطول:</strong> <%= player.height ? player.height + ' سم' : 'غير محدد' %></p>
              <p><strong>الوزن:</strong> <%= player.weight ? player.weight + ' كجم' : 'غير محدد' %></p>
              <p><strong>الهاتف:</strong> <%= player.phoneNumber || 'غير محدد' %></p>
            </div>
            <a href="/attendance/player/<%= player._id %>" class="btn btn-info">
              <i class="fas fa-history me-1"></i> سجل الحضور الكامل
            </a>
          </div>
        </div>
      </div>

      <!-- Sports Tests Section -->
      <% if (player.sportsTests && player.sportsTests.length > 0) { %>
        <div class="card mb-4">
          <div class="card-header bg-info text-white">
            <h5 class="mb-0">الاختبارات الرياضية</h5>
          </div>
          <div class="card-body">
            <div class="table-responsive">
              <table class="table table-striped">
                <thead>
                  <tr>
                    <th>اسم الاختبار</th>
                    <th>النتيجة</th>
                    <th>التاريخ</th>
                  </tr>
                </thead>
                <tbody>
                  <% player.sportsTests.forEach(test => { %>
                    <tr>
                      <td><%= test.testName %></td>
                      <td><%= test.result %></td>
                      <td><%= new Date(test.date).toLocaleDateString('ar-EG') %></td>
                    </tr>
                  <% }); %>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      <% } %>
    </div>

    <!-- Attendance and Actions Column -->
    <% if (user && user.isAdmin) { %>
      <div class="col-md-6">
        <div class="card mb-4">
          <div class="card-header bg-success text-white">
            <h5 class="mb-0">الإجراءات</h5>
          </div>
          <div class="card-body">
            <div class="d-grid gap-2">
              <a href="/listings/<%= player._id %>/edit" class="btn btn-warning">
                <i class="fas fa-edit me-1"></i> تعديل البيانات
              </a>
              <a href="/attendance/player/<%= player._id %>" class="btn btn-info">
                <i class="fas fa-history me-1"></i> سجل الحضور الكامل
              </a>
              <form action="/listings/<%= player._id %>?_method=DELETE" method="POST" class="d-grid">
                <button type="submit" class="btn btn-danger" 
                  onclick="return confirm('هل أنت متأكد من حذف هذا اللاعب؟')">
                  <i class="fas fa-trash-alt me-1"></i> حذف اللاعب
                </button>
              </form>
            </div>
          </div>
        </div>
        <%}%>
        <!-- Attendance History -->
        <div class="card">
          <div class="card-header bg-dark text-white">
            <h5 class="mb-0">سجل الحضور الأخير</h5>
          </div>
          <div class="card-body">
            <% if (attendanceRecords.length > 0) { %>
              <div class="table-responsive">
                <table class="table table-striped">
                  <thead>
                    <tr>
                      <th>التاريخ</th>
                      <th>الحالة</th>
                      <th>ملاحظات</th>
                    </tr>
                  </thead>
                  <tbody>
                    <% attendanceRecords.forEach(record => { %>
                      <tr>
                        <td><%= new Date(record.date).toLocaleDateString('ar-EG') %></td>
                        <td>
                          <span class="badge bg-<%= 
                            record.status === 'present' ? 'success' : 
                            record.status === 'late' ? 'warning' : 'danger' 
                          %>">
                            <%= 
                              record.status === 'present' ? 'حاضر' : 
                              record.status === 'late' ? 'متأخر' : 'غائب' 
                            %>
                          </span>
                        </td>
                        <td><%= record.comment || 'لا يوجد' %></td>
                      </tr>
                    <% }); %>
                  </tbody>
                </table>
              </div>
            <% } else { %>
              <div class="alert alert-info text-center py-3">
                <i class="fas fa-info-circle me-2"></i>
                لا توجد سجلات حضور لهذا اللاعب
              </div>
            <% } %>
          </div>
        </div>
      </div>
  </div>
</div>